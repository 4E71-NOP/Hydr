<?php
 /*Hydre-licence-debut*/
// --------------------------------------------------------------------------------------------
//
//	Hydre - Le petit moteur de web
//	Sous licence Creative Common	
//	Under Creative Common licence	CC-by-nc-sa (http://creativecommons.org)
//	CC by = Attribution; CC NC = Non commercial; CC SA = Share Alike
//
//	(c)Faust MARIA DE AREVALO faust@club-internet.fr
//
// --------------------------------------------------------------------------------------------
/*Hydre-licence-fin*/
//theme_etat					OFFLINE:0	ONLINE:1	SUPPRIME:2
//theme_admctrl_position		1 H-G	2 H-M	3 H-D	4 M-D	5 B-D	6 B-M	7 B-G	8 M-G

$_REQUEST['liste_colonne']['theme'] = array (
"theme_id",
"theme_repertoire",
"theme_nom",		"theme_titre",
"theme_desc",
"theme_date",
"theme_stylesheet_1",
"theme_stylesheet_2",
"theme_stylesheet_3",
"theme_stylesheet_4",
"theme_stylesheet_5",
"theme_bg",
"theme_bg_repeat",
"theme_bg_color",
"theme_blason",
"theme_banniere",
"theme_divinitial_bg",
"theme_divinitial_repeat",
"theme_divinitial_dx",
"theme_divinitial_dy",
"theme_bloc_01_nom",		"theme_bloc_01_texte",
"theme_bloc_02_nom",		"theme_bloc_02_texte",
"theme_bloc_03_nom",		"theme_bloc_03_texte",
"theme_bloc_04_nom",		"theme_bloc_04_texte",
"theme_bloc_05_nom",		"theme_bloc_05_texte",
"theme_bloc_06_nom",		"theme_bloc_06_texte",
"theme_bloc_07_nom",		"theme_bloc_07_texte",
"theme_bloc_08_nom",		"theme_bloc_08_texte",
"theme_bloc_09_nom",		"theme_bloc_09_texte",
"theme_bloc_10_nom",		"theme_bloc_10_texte",
"theme_bloc_11_nom",		"theme_bloc_11_texte",
"theme_bloc_12_nom",		"theme_bloc_12_texte",
"theme_bloc_13_nom",		"theme_bloc_13_texte",
"theme_bloc_14_nom",		"theme_bloc_14_texte",
"theme_bloc_15_nom",		"theme_bloc_15_texte",
"theme_bloc_16_nom",		"theme_bloc_16_texte",
"theme_bloc_17_nom",		"theme_bloc_17_texte",
"theme_bloc_18_nom",		"theme_bloc_18_texte",
"theme_bloc_19_nom",		"theme_bloc_19_texte",
"theme_bloc_20_nom",		"theme_bloc_20_texte",
"theme_bloc_21_nom",		"theme_bloc_21_texte",
"theme_bloc_22_nom",		"theme_bloc_22_texte",
"theme_bloc_23_nom",		"theme_bloc_23_texte",
"theme_bloc_24_nom",		"theme_bloc_24_texte",
"theme_bloc_25_nom",		"theme_bloc_25_texte",
"theme_bloc_26_nom",		"theme_bloc_26_texte",
"theme_bloc_27_nom",		"theme_bloc_27_texte",
"theme_bloc_28_nom",		"theme_bloc_28_texte",
"theme_bloc_29_nom",		"theme_bloc_29_texte",
"theme_bloc_30_nom",		"theme_bloc_30_texte",
"theme_bloc_00_menu",
"theme_bloc_01_menu",
"theme_bloc_02_menu",
"theme_bloc_03_menu",
"theme_bloc_04_menu",
"theme_bloc_05_menu",
"theme_bloc_06_menu",
"theme_bloc_07_menu",
"theme_bloc_08_menu",
"theme_bloc_09_menu",
"theme_admctrl_panel_bg",
"theme_admctrl_switch_bg",
"theme_admctrl_size_x",
"theme_admctrl_size_y",
"theme_admctrl_position",
"theme_couleur_jauge_depart",
"theme_couleur_jauge_milieu",
"theme_couleur_jauge_fin"
);

$_REQUEST['liste_colonne']['theme_conversion'] = array (
"theme_etat",
"theme_admctrl_position",
);

$_REQUEST['liste_colonne']['theme_reference'] = array (
"id",
"repertoire",
"nom",		"titre",
"desc",
"date",
"stylesheet_1",
"stylesheet_2",
"stylesheet_3",
"stylesheet_4",
"stylesheet_5",
"bg",
"bg_repeat",
"bg_color",
"blason",
"banniere",
"divinitial_bg",
"divinitial_repeat",
"divinitial_dx",
"divinitial_dy",
"bloc_01_nom",		"bloc_01_texte",
"bloc_02_nom",		"bloc_02_texte",
"bloc_03_nom",		"bloc_03_texte",
"bloc_04_nom",		"bloc_04_texte",
"bloc_05_nom",		"bloc_05_texte",
"bloc_06_nom",		"bloc_06_texte",
"bloc_07_nom",		"bloc_07_texte",
"bloc_08_nom",		"bloc_08_texte",
"bloc_09_nom",		"bloc_09_texte",
"bloc_10_nom",		"bloc_10_texte",
"bloc_11_nom",		"bloc_11_texte",
"bloc_12_nom",		"bloc_12_texte",
"bloc_13_nom",		"bloc_13_texte",
"bloc_14_nom",		"bloc_14_texte",
"bloc_15_nom",		"bloc_15_texte",
"bloc_16_nom",		"bloc_16_texte",
"bloc_17_nom",		"bloc_17_texte",
"bloc_18_nom",		"bloc_18_texte",
"bloc_19_nom",		"bloc_19_texte",
"bloc_20_nom",		"bloc_20_texte",
"bloc_21_nom",		"bloc_21_texte",
"bloc_22_nom",		"bloc_22_texte",
"bloc_23_nom",		"bloc_23_texte",
"bloc_24_nom",		"bloc_24_texte",
"bloc_25_nom",		"bloc_25_texte",
"bloc_26_nom",		"bloc_26_texte",
"bloc_27_nom",		"bloc_27_texte",
"bloc_28_nom",		"bloc_28_texte",
"bloc_29_nom",		"bloc_29_texte",
"bloc_30_nom",		"bloc_30_texte",
"bloc_00_menu",
"bloc_01_menu",
"bloc_02_menu",
"bloc_03_menu",
"bloc_04_menu",
"bloc_05_menu",
"bloc_06_menu",
"bloc_07_menu",
"bloc_08_menu",
"bloc_09_menu",
"admctrl_panel_bg",
"admctrl_switch_bg",
"admctrl_size_x",
"admctrl_size_y",
"admctrl_position",
"couleur_jauge_depart",
"couleur_jauge_milieu",
"couleur_jauge_fin",
"etat"
);
function initialisation_valeurs_theme () {
	$R = &$_REQUEST['M_THEME'];

	$R['id']			= "";
	$R['repertoire']	= "";
	$R['nom']			= "Nouveau theme";
	$R['titre']			= "Nouveau theme";
	$R['desc']			= "Nouveau theme";
	$R['date']			= time();

	$R['stylesheet_1']	= "";
	$R['stylesheet_2']	= "";
	$R['stylesheet_3']	= "";
	$R['stylesheet_4']	= "";
	$R['stylesheet_5']	= "";

	$R['bg']			= "";
	$R['bg_repeat'] 	= "repeat";
	$R['bg_color'] 		= "";
	$R['blason']		= "";
	$R['banniere']		= "";

	$R['divinitial_bg']		= "";
	$R['divinitial_repeat']	= "no-repeat";
	$R['divinitial_dx']		= 0;
	$R['divinitial_dy']		= 0;

	for ( $pv['i'] = 1 ; $pv['i'] <= 30 ; $pv['i']++ ) {
		$pv['j'] = sprintf("%02u", $pv['i'] );
		$R['bloc_'.$pv['j'].'_nom'] = "";
		$R['bloc_'.$pv['j'].'_texte'] = "";
	}
	for ( $pv['i'] = 0 ; $pv['i'] <= 9 ; $pv['i']++ ) {
		$pv['j'] = sprintf("%02u", $pv['i'] );
		$R['bloc_'.$pv['j'].'_menu']	= "";
	} 

	$R['admctrl_panel_bg']		= "vide.gif";
	$R['admctrl_switch_bg']		= "vide.gif";
	$R['admctrl_size_x']		= 32;
	$R['admctrl_size_y']		= 32;
	$R['admctrl_position']		= 1;
	$R['couleur_jauge_depart']	= "000000";
	$R['couleur_jauge_milieu']	= "808000";
	$R['couleur_jauge_fin']		= "FF0000";

	$R['etat'] = "en_ligne";
	$R['filtre'] = "";

	$R['name']			= &$R['nom'];
	$R['title']			= &$R['titre'];
	$R['directory']		= &$R['repertoire'];
	$R['desc']			= &$R['desc'];
	$R['description']	= &$R['desc'];
	$R['state']			= &$R['etat'];
	$R['filter']		= &$R['filtre'];

	for ( $pv['i'] = 1 ; $pv['i'] <= 30 ; $pv['i']++ ) {
		$pv['j'] = sprintf("%02u", $pv['i'] );
		$R['block_'.$pv['j'].'_name']	= &$R['bloc_'.$pv['j'].'_nom'];
		$R['block_'.$pv['j'].'_text']	= &$R['bloc_'.$pv['j'].'_texte'];
	}
	for ( $pv['i'] = 0 ; $pv['i'] <= 9 ; $pv['i']++ ) {
		$pv['j'] = sprintf("%02u", $pv['i'] );
		$R['block_'.$pv['j'].'_menu']	= &$R['bloc_'.$pv['j'].'_menu'];
	}

	reset ( $_REQUEST['liste_colonne']['theme_reference'] );
	foreach ( $_REQUEST['liste_colonne']['theme_reference'] as $A ) { $R['theme_'.$A] = &$R[$A];	}
}

function chargement_valeurs_theme () {
	global $SQL_tab , $SQL_tab_abrege, $tab_conv_expr;
	$R = &$_REQUEST['M_THEME'];

	$tl_['eng']['log_init'] = "Loading deadline datas";
	$tl_['fra']['log_init'] = "Chargement valeurs du bouclage";

	$l = $_REQUEST['site_context']['site_lang'];
	$_REQUEST['sql_initiateur'] = $tl_[$l]['log_init'];

	$dbquery = requete_sql($_REQUEST['sql_initiateur'],"
	SELECT sk.*, ss.theme_etat  
	FROM ".$SQL_tab_abrege['theme_descripteur']." sk , ".$SQL_tab_abrege['site_theme']." ss 
	WHERE ss.site_id = '".$_REQUEST['site_context']['site_id']."' 
	AND ss.theme_id = sk.theme_id 
	AND sk.theme_nom ='".$R['nom']."' 
	;");

	if ( num_row_sql($dbquery) == 0 ) {
		$tl_['eng']['err_001'] = "The theme named '".$R['nom']."' doesn't exists.";
		$tl_['fra']['err_001'] = "Le theme '".$R['nom']."' n'existe pas.";
		journalisation_evenement ( 1 , $_REQUEST['sql_initiateur'] , $_REQUEST['tampon_commande'] , "ERR" , "CVS_001" ,$tl_[$l]['err_001'] ); 
	}
	else {
		$p = $tab_conv_expr['MS']['offline'];	$tab_etat[$p] = "offline";
		$p = $tab_conv_expr['MS']['online'];	$tab_etat[$p] = "online";
		while ($dbp = fetch_array_sql($dbquery)) { 
			foreach ( $dbp as $A => $B ) { $R[$A] = $B; }
		}
	}
}

?>
